### STAGE 1: Build ###
FROM node:lts-alpine3.16 as axis
WORKDIR /opt/videoplatform
ARG BASE_HREF=axisdemo
COPY ./axisbankSupport .
RUN npm install --location=global npm

# Build OpenVidu Call frontend
RUN npm install --force && \
    npm run prod:build-path ${BASE_HREF} && \
    cd ../ && rm -rf openvidu-call-front

### STAGE 3: Run ###
FROM nginx:1.17.1-alpine
RUN ls -ltrh
COPY docker/CustomerNginx.conf /etc/nginx/nginx.conf
COPY --from=axis /opt/videoplatform/dist/ /usr/share/nginx/html/
